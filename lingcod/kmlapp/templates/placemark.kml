{% extends "style.kml" %}
{% block folders_and_placemarks %}
{% load rest_uid array_uid mpa_uid %}
{% for array_name, a in shapes.items %}
 <Folder>
  <name>{{ a.array.name }}</name>
	{% if a.array.id %}
  	<atom:link rel="marinemap.update_form" title="Edit {{a.array.name}}" mm:icon="/path/to/icon.jpg" mm:model="{% array_uid %}" href="{% url array_update_form pk=a.array.id %}" />
  	<atom:link rel="self" title="{{ a.array.name }}" mm:model="{% array_uid %}" href="{{ a.array.get_absolute_url }}" />
	{% endif %}
  <visibility>1</visibility>
  <open>0</open>
 {% for mpa in a.mpas %} 
  <Placemark id="mpa_{{ mpa.id }}">
    <name>{{ mpa.name }}</name>
    <styleUrl>#{{ mpa.designation.acronym }}-style</styleUrl>
    <atom:link rel="marinemap.update_form" title="Edit" mm:icon="/path/to/icon.jpg" mm:model="{% mpa_uid %}" href="/path/to/form/1" />
    <atom:link rel="self" title="{{mpa.name}}" mm:model="{% mpa_uid %}" href="/path/to/mpa/attributes" />
    <ExtendedData>
      <Data name="mpaid"><value>{{ mpa.id }}</value></Data>
      <Data name="name"><value>{{ mpa.name }}</value></Data>
      <Data name="user"><value>{{ mpa.user }}</value></Data>
      <Data name="created"><value>{{ mpa.date_created }}</value></Data>
      <Data name="modified"><value>{{ mpa.date_modified }}</value></Data>
      <Data name="area"><value>{{ mpa.geometry_final.area }}</value></Data>
      <Data name="designation"><value>{{ mpa.designation }}</value></Data>
    </ExtendedData>
    {{ mpa.geom_as_kml|safe }} 
  </Placemark>
 {% endfor %}
 </Folder>
{% endfor %}
{% endblock %}
